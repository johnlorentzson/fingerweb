{% extends "base.html" %}
{% block title %}Tjänsten {{service}}{% endblock %}

{% block content %}
<h1>Tjänsten {{service}}</h1>

{{service.description_html |safe}}

{% if has_account %}
<p>{{user}} has an account for this service.</p>
{% if secret %}
<p class="pwd">Your password is "<code>{{secret}}</code>". </p>
<script type="text/javascript">
  window.history.pushState({}, document.title, document.location);

  var copyBtn = document.createElement('button');
  copyBtn.append(document.createTextNode('Copy'))
  document.querySelector('p.pwd').append(copyBtn);
  copyBtn.addEventListener('click', function(event) {
    var pwd = document.querySelector('p.pwd code');
    var range = document.createRange();
    range.selectNode(pwd);
    window.getSelection().addRange(range);

    try {
      var successful = document.execCommand('copy');
      console.log('Copy email command was ' + (successful ? '' : 'un') + 'successful');
    } catch(err) {
      console.log('Oops, unable to copy');
    }
  });
</script>
<form method="get"><button>Hide password</button></form>
{% else %}
<form method="post">{% csrf_token %}
  <button name="action" value="show">Show password</button>
</form>
{% endif %}
<form method="post">{% csrf_token %}
  <button name="action" value="generate">Reset password</button>
</form>
{% else %}
<p>You don't have a password for this service yet.</p>
<form method="post">{% csrf_token %}
  <button name="action" value="generate">Generate a password</button>
</form>
{% endif %}
{% endblock %}
